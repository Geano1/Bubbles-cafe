import React, { useState, useEffect } from 'react';
import axios from 'axios';
import './Story.css'; // Import CSS for styling

interface Story {
  id: number;
  title: string;
  content: string;
  likes: number;
  dislikes: number;
}

const Story: React.FC<{ storyId: number }> = ({ storyId }) => {
  const [story, setStory] = useState<Story | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchStory = async () => {
      try {
        const response = await axios.get(`/api/stories/${storyId}`);
        setStory(response.data);
      } catch (err) {
        setError('Failed to fetch story');
      } finally {
        setLoading(false);
      }
    };

    fetchStory();
  }, [storyId]);

  const handleLike = async () => {
    if (story && story.likes < 150) {
      try {
        await axios.post(`/api/stories/${story.id}/like`);
        setStory((prevStory) => ({
          ...prevStory!,
          likes: prevStory!.likes + 1,
        }));
      } catch (err) {
        setError('Failed to like story');
      }
    }
  };

  const handleDislike = async () => {
    if (story && story.dislikes < 15) {
      try {
        await axios.post(`/api/stories/${story.id}/dislike`);
        setStory((prevStory) => ({
          ...prevStory!,
          dislikes: prevStory!.dislikes + 1,
        }));
      } catch (err) {
        setError('Failed to dislike story');
      }
    }
  };

  if (loading) return <div>Loading...</div>;
  if (error) return <div>{error}</div>;

  return (
    <div className="story-container">
      <h1 className="story-title">{story.title}</h1>
      <div className="story-content" dangerouslySetInnerHTML={{ __html: story.content }} />
      <div className="story-interactions">
        <button onClick={handleLike} disabled={story.likes >= 150}>
          Like ({story.likes})
        </button>
        <button onClick={handleDislike} disabled={story.dislikes >= 15}>
          Dislike ({story.dislikes})
        </button>
      </div>
    </div>
  );
};

export default Story;